const container=document.querySelector(".background-game");let difficulty,squares,rows,autoplayIntervalToDigSquare,isDesktopRes,panelShownPriorWindowResize,boardWidth=container.offsetWidth,boardHeight=container.offsetHeight,screenWidth=window.innerWidth,squareSize=32,columnsToFit=Math.floor(boardWidth/squareSize),rowsToFit=Math.floor(boardHeight/squareSize),matrix=[],bombsPlaced=0,squaresInBoard=0,squaresInterractedWith=0,squaresInViewport=0,autoplayRunning=!0,windowWidth=window.innerWidth,flagSvg='<svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><rect x="0.666504" width="17" height="18" fill="url(#pattern0)"/><defs><pattern id="pattern0" patternContentUnits="objectBoundingBox" width="1" height="1"><use xlink:href="#image0_14_9231" transform="matrix(0.00827206 0 0 0.0078125 -0.0294118 0)"/></pattern><image id="image0_14_9231" width="128" height="128" xlink:href="data:image/png;base64,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"/></defs></svg>';function populateBoard(){matrix=[],container.innerHTML="",squaresInBoard=0,squaresInterractedWith=0,bombsPlaced=0,difficulty=.35,container.style.gridTemplateRows=`repeat(${rowsToFit}, minmax(24px, 1fr))`;for(let e=0;e<rowsToFit;e++)matrix.push([]),container.insertAdjacentHTML("beforeEnd",'<div class="row"></div>');rows=document.querySelectorAll(".row"),rows.forEach(((e,t)=>{for(let r=0;r<columnsToFit;r++)generateSquare(e,t,r);e.style.gridTemplateColumns=`repeat(${columnsToFit}, minmax(24px, 1fr))`})),squares=document.querySelectorAll(".square")}function generateSquare(e,t,r){let a=!1;Math.random()<difficulty&&(bombsPlaced++,a=!0),matrix[t].push({isRevealed:!1,hasBomb:a,isFlagged:!1,position:`${t}_${r}`,isWithinViewport:!0}),squaresInBoard++,squaresInViewport++,e.insertAdjacentHTML("beforeEnd",`<div class="square" data-position="${t}_${r}"></div>`)}function autoplayGame(){let e=matrix.reduce(((e,t)=>e.concat(t)));function t(){if(0==e.length)clearInterval(autoplayIntervalToDigSquare),populateBoard(),autoplayGame();else{let t=Math.floor(Math.random()*e.length),r=e[t].position,a=r.split("_")[0],i=r.split("_")[1];if(e[t].hasBomb){return matrix[a][i].isFlagged=!0,document.querySelector(`[data-position="${a}_${i}"]`).innerHTML=flagSvg,void e.splice(t,1)}digSquare(a,i),e.splice(t,1),0==countBombs(a,i)&&(e=e.filter((e=>{if(!e.isRevealed&&!e.isFlagged)return e})))}}autoplayRunning=!0,t(),autoplayIntervalToDigSquare=setInterval(t,1100)}function startGame(){populateBoard()}function userLeftClick(e){if(!e.currentTarget.classList.contains("revealed")){digSquare(e.currentTarget.dataset.position.split("_")[0],e.currentTarget.dataset.position.split("_")[1]),isGameFinished()}}function digSquare(e,t){let r=document.querySelector(`[data-position="${e}_${t}"]`);0==matrix[e][t].isFlagged&&(matrix[e][t].isRevealed=!0,squaresInterractedWith++,matrix[e][t].hasBomb?(r.innerHTML='<img src="/icons/bomb.svg"></img>',r.classList.add("revealed"),userDugBombPosition=`${e}_${t}`):0==countBombs(e,t)?emptySquare(e,t):(r.innerHTML=countBombs(e,t),r.classList.add(`B${countBombs(e,t)}`)),r.classList.add("revealed"))}function userRightClick(e){e.preventDefault();let t=e.currentTarget.dataset.position.split("_")[0],r=e.currentTarget.dataset.position.split("_")[1];0==e.currentTarget.classList.contains("revealed")&&(0==matrix[t][r].isFlagged?(matrix[t][r].isFlagged=!0,squaresInterractedWith++,bombsPlaced-=1,e.currentTarget.innerHTML=flagSvg,tellUserBombsPlaced.textContent=`// ${bombsPlaced}`):(matrix[t][r].isFlagged=!1,squaresInterractedWith-=1,bombsPlaced++,e.currentTarget.innerHTML="",tellUserBombsPlaced.textContent=`// ${bombsPlaced}`)),isGameFinished()}function countBombs(e,t){let r=0;return checkSurroundingSquares(e,t).forEach((e=>{e.hasBomb&&r++})),r}function checkSurroundingSquares(e,t){let r=[];for(let a=-1;a<2;a++)if(null!=matrix[Number(e)+Number(a)])for(let i=-1;i<2;i++)null!=matrix[Number(e)+Number(a)][Number(t)+Number(i)]&&(Number(e)+Number(a)==e&&Number(t)+Number(i)==t||r.push(matrix[Number(e)+Number(a)][Number(t)+Number(i)]));return r}function emptySquare(e,t){checkSurroundingSquares(e,t).forEach((e=>{let t=e.position.split("_")[0],r=e.position.split("_")[1];if(0==matrix[t][r].isRevealed&&0==matrix[t][r].isFlagged){let e=document.querySelector(`[data-position="${t}_${r}"]`),a=countBombs(t,r);squaresInterractedWith++,matrix[t][r].isRevealed=!0,e.classList.add("revealed"),e.classList.add(`B${a}`),0!=a?e.innerHTML=a:emptySquare(t,r)}}))}function isGameFinished(){squaresInViewport===squaresInterractedWith&&(autoplayRunning?populateBoard():winGame())}function updateOldSiblingSquaresNearNewlyAddedSquares(e){let t=e.dataset.position.split("_")[0],r=e.dataset.position.split("_")[1],a="B"+e.textContent,i=countBombs(t,r);e.innerHTML=i,e.classList.replace(a,`B${i}`)}container.addEventListener("contextmenu",(e=>{e.preventDefault()})),populateBoard(),autoplayGame(),window.addEventListener("resize",(()=>{let e=container.offsetWidth,t=container.offsetHeight,r=Math.floor(e/squareSize),a=Math.floor(t/squareSize),i=r-columnsToFit,n=a-rowsToFit;if(screenWidth=window.innerWidth,r>columnsToFit){clearInterval(autoplayIntervalToDigSquare);let t=[];rows.forEach((e=>{e.lastChild.classList.contains("revealed")&&""!=e.lastChild.textContent&&t.push(e.lastChild)}));for(let e=0;e<i;e++)rows.forEach(((e,t)=>{generateSquare(e,t,matrix[t].length),e.lastChild.addEventListener("click",(e=>{userLeftClick(e)})),e.lastChild.addEventListener("contextmenu",(e=>{userRightClick(e)})),e.style.gridTemplateColumns=`repeat(${r}, minmax(24px, 1fr))`}));t.forEach((e=>{updateOldSiblingSquaresNearNewlyAddedSquares(e)})),columnsToFit=r,boardWidth=e,squares=document.querySelectorAll(".square"),autoplayGame()}if(a>rowsToFit){clearInterval(autoplayIntervalToDigSquare);for(let e=0;e<n;e++){let e=matrix.length-1;matrix.push([]),container.insertAdjacentHTML("beforeEnd",'<div class="row"></div>');for(let t=0;t<columnsToFit;t++)generateSquare(container.lastChild,e,t),container.lastChild.lastChild.addEventListener("click",(e=>{userLeftClick(e)})),container.lastChild.lastChild.addEventListener("contextmenu",(e=>{userRightClick(e)}));container.lastChild.style.gridTemplateColumns=`repeat(${columnsToFit}, minmax(24px, 1fr))`}container.lastChild.previousSibling.childNodes.forEach((e=>{e.classList.contains("revealed")&&""!=e.textContent&&updateOldSiblingSquaresNearNewlyAddedSquares(e)})),container.style.gridTemplateRows=`repeat(${a}, minmax(24px, 1fr))`,rowsToFit=a,boardHeight=t,rows=document.querySelectorAll(".row"),autoplayGame()}}));